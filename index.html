<!DOCTYPE html>
<html lang="pt-BR">
<head>
<link rel="manifest" href="manifest.json">

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Minutagens</title>

<style>
/* RESET */
body {
    margin: 0;
    padding: 0;
    background: #1e1e1e;
    font-family: Arial, sans-serif;

    display: flex;
    justify-content: center;
    align-items: center;

    width: 100vw;
    height: 100vh;
}

/* CONTAINER 9:16 */
#app {
    width: 100vw;
    max-width: 430px;
    height: 100vh;
    aspect-ratio: 9 / 16;
    background: #e5e5e5;
    display: flex;
    flex-direction: column;
}

#app * {
    box-sizing: border-box;
}

/* TOPO */
#tasks {
    background: #e5e5e5;
    padding: 10px;
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

.task {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 16px;
    cursor: pointer;
    color: #000;
}

.task.active {
    font-size: 22px;
    border: 2px solid #000;
}

button {
    cursor: pointer;
}

button[onclick="addTask()"] {
    width: 30px;
    height: 30px;
    font-size: 20px;
    background: #666;
    color: white;
    border: none;
    border-radius: 4px;
}

hr {
    width: 100%;
    border: none;
    height: 10px;
    background: #e5e5e5;
    margin: 0;
}

/* BLOCO CENTRAL */
#screen {
    background: #e5e5e5;
    padding: 15px;
    flex: 1;
}

/* BLOCO DE NOTAS */
#notes {
    width: 100%;
    height: 100%;
    background: #6b6b6b;
    color: white;
    border: none;
    resize: none;
    font-size: 18px;
    padding: 10px;
}

/* TECLADO */
#keyboard {
    background: #e5e5e5;
    padding: 10px;
    text-align: center;
}

#keyboard button {
    width: 60px;
    height: 50px;
    margin: 5px;
    font-size: 18px;
    background: #555;
    color: white;
    border: none;
    border-radius: 6px;
}

/* RODAPÃ‰ */
#footer {
    background: #e5e5e5;
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#totalTime {
    font-size: 22px;
    font-weight: bold;
}

#playBtn {
    width: 50px;
    height: 40px;
    font-size: 20px;
    background: #555;
    color: white;
    border: none;
    border-radius: 6px;
}

/* SELETOR DE CORES */
#colorPicker {
    position: fixed;
    bottom: 80px;
    background: #333;
    padding: 10px;
    border-radius: 10px;
    display: none;
    gap: 10px;
}

.colorOption {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid #fff;
}
</style>
</head>

<body>

<div id="app">

    <!-- TOPO -->
    <div id="tasks"></div>
    <button onclick="addTask()">+</button>

    <hr>

    <!-- BLOCO CENTRAL -->
    <div id="screen" onclick="showPhoneKeyboard()">
        <textarea id="notes" placeholder="Digite os tempos..."></textarea>
    </div>

    <!-- TECLADO -->
    <div id="keyboard" style="display:none;">
        <button onclick="press('1')">1</button>
        <button onclick="press('2')">2</button>
        <button onclick="press('3')">3</button><br>
        <button onclick="press('4')">4</button>
        <button onclick="press('5')">5</button>
        <button onclick="press('6')">6</button><br>
        <button onclick="press('7')">7</button>
        <button onclick="press('8')">8</button>
        <button onclick="press('9')">9</button><br>
        <button onclick="press(':')">*</button>
        <button onclick="press('0')">0</button>
        <button onclick="newline()">â†µ</button>
    </div>

    <hr>

    <!-- RODAPÃ‰ -->
    <div id="footer">
        <span id="totalTime">00:00</span>
        <button onclick="togglePlay()" id="playBtn">â–¶</button>
        <button onclick="clearNotes()">ðŸ—‘</button>
    </div>

</div>

<!-- PAINEL DE CORES -->
<div id="colorPicker">
    <div class="colorOption" style="background:#4da3ff" onclick="setTaskColor('#4da3ff')"></div>
    <div class="colorOption" style="background:#ffd84d" onclick="setTaskColor('#ffd84d')"></div>
    <div class="colorOption" style="background:#ff5c5c" onclick="setTaskColor('#ff5c5c')"></div>
    <div class="colorOption" style="background:#b57bff" onclick="setTaskColor('#b57bff')"></div>
</div>

<script>
let tasks = []; // { name, color }
let timers = [];
let originalTimers = [];
let currentIndex = 0;
let playing = false;
let interval = null;
let selectedTaskIndex = null;

/* ===== TAREFAS ===== */
function renderTasks(activeTaskIndex = null) {
    const container = document.getElementById("tasks");
    container.innerHTML = "";

    tasks.forEach((t, i) => {
        const span = document.createElement("span");
        span.className = "task" + (i === activeTaskIndex ? " active" : "");
        span.style.background = t.color || "#ccc";
        span.textContent = t.name;
        span.onclick = () => openColorPicker(i);
        container.appendChild(span);
    });
}

function addTask() {
    let name = prompt("Nome da tarefa:");
    if (!name) return;

    tasks.push({ name, color: "#4da3ff" }); // cor padrÃ£o
    renderTasks(currentIndex % (tasks.length || 1));
}

/* ===== SELETOR DE COR ===== */
function openColorPicker(index) {
    selectedTaskIndex = index;
    document.getElementById("colorPicker").style.display = "flex";
}

function setTaskColor(color) {
    if (selectedTaskIndex === null) return;
    tasks[selectedTaskIndex].color = color;
    selectedTaskIndex = null;
    document.getElementById("colorPicker").style.display = "none";
    renderTasks(currentIndex % (tasks.length || 1));
}

/* ===== TECLADO ===== */
function showPhoneKeyboard() {
    if (!playing) {
        document.getElementById("keyboard").style.display = "block";
    }
}

function hidePhoneKeyboard() {
    document.getElementById("keyboard").style.display = "none";
}

/* ===== INPUT ===== */
function press(val) {
    document.getElementById("notes").value += val;
    recalc();
}

function newline() {
    document.getElementById("notes").value += "\n";
    recalc();
}

/* ===== LIMPAR ===== */
function clearNotes() {
    stop();
    playing = false;
    document.getElementById("playBtn").innerText = "â–¶";
    document.getElementById("notes").value = "";
    document.getElementById("totalTime").innerText = "00:00";
    document.getElementById("notes").style.background = "#6b6b6b";
    timers = [];
    originalTimers = [];
    currentIndex = 0;
    renderTasks(null);
}

/* ===== TEMPOS ===== */
function parseTimes() {
    let text = document.getElementById("notes").value.trim();
    if (!text) return [];
    let lines = text.split("\n");
    return lines.map(l => {
        let p = l.split(":");
        return parseInt(p[0]) * 60 + parseInt(p[1]);
    });
}

function format(sec) {
    let m = Math.floor(sec / 60);
    let s = sec % 60;
    return String(m).padStart(2,"0") + ":" + String(s).padStart(2,"0");
}

function recalc() {
    let times = parseTimes();
    let total = times.reduce((a,b)=>a+b,0);
    document.getElementById("totalTime").innerText = format(total);
}

/* ===== PLAY / PAUSE ===== */
function togglePlay() {
    if (tasks.length === 0) {
        alert("Adicione pelo menos uma tarefa.");
        return;
    }

    if (parseTimes().length === 0) {
        alert("Adicione pelo menos um tempo.");
        return;
    }

    playing = !playing;
    document.getElementById("playBtn").innerText = playing ? "â¸" : "â–¶";

    if (playing) {
        hidePhoneKeyboard();
        start();
    } else {
        stop();
    }
}

function start() {
    originalTimers = parseTimes();
    timers = [...originalTimers];
    currentIndex = 0;
    run();
}

function run() {
    if (currentIndex >= timers.length) {
        stop();
        return;
    }

    interval = setInterval(() => {
        if (!playing) return;

        timers[currentIndex]--;
        updateDisplay();

        if (timers[currentIndex] <= 0) {
            clearInterval(interval);
            currentIndex++;
            run();
        }
    }, 1000);
}

function stop() {
    clearInterval(interval);
}

/* ===== ATUALIZA UI ===== */
function updateDisplay() {
    let lines = document.getElementById("notes").value.trim().split("\n");
    let newText = "";

    lines.forEach((l, i) => {
        if (i === currentIndex) {
            l = format(timers[i]);
        }
        newText += l + "\n";
    });

    document.getElementById("notes").value = newText.trim();

    let total = timers.reduce((a,b)=>a+b,0);
    document.getElementById("totalTime").innerText = format(total);

    let activeTaskIndex = currentIndex % tasks.length;
    renderTasks(activeTaskIndex);

    if (tasks[activeTaskIndex]) {
        document.getElementById("notes").style.background = tasks[activeTaskIndex].color;
    }
}
</script>

</body>
</html>
