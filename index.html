<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<title>Minutagens</title>

<style>
body {
    margin: 0;
    padding: 0;
    background: #1e1e1e;
    font-family: Arial, sans-serif;

    display: flex;
    justify-content: center;
    align-items: center;

    width: 100vw;
    height: 100vh;
}

#app {
    width: 100vw;
    max-width: 430px;
    height: 100vh;
    aspect-ratio: 9 / 16;
    background: #e5e5e5;
    display: flex;
    flex-direction: column;
}

#app * {
    box-sizing: border-box;
}

/* TOPO */
#tasks {
    background: #e5e5e5;
    padding: 10px;
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

button {
    cursor: pointer;
}

button[onclick="addTask()"] {
    width: 30px;
    height: 30px;
    font-size: 20px;
    background: #666;
    color: white;
    border: none;
    border-radius: 4px;
}

hr {
    width: 100%;
    border: none;
    height: 10px;
    background: #e5e5e5;
    margin: 0;
}

/* BLOCO CENTRAL */
#screen {
    background: #e5e5e5;
    padding: 15px;
    flex: 1;
}

/* BLOCO DE NOTAS */
#notes {
    width: 100%;
    height: 100%;
    background: #6b6b6b;
    color: white;
    border: none;
    resize: none;
    font-size: 18px;
    padding: 10px;
}

/* TECLADO */
#keyboard {
    background: #e5e5e5;
    padding: 10px;
    text-align: center;
}

#keyboard button {
    width: 60px;
    height: 50px;
    margin: 5px;
    font-size: 18px;
    background: #555;
    color: white;
    border: none;
    border-radius: 6px;
}

/* RODAPÃ‰ */
#footer {
    background: #e5e5e5;
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#totalTime {
    font-size: 22px;
    font-weight: bold;
}

#playBtn {
    width: 50px;
    height: 40px;
    font-size: 20px;
    background: #555;
    color: white;
    border: none;
    border-radius: 6px;
}
</style>
</head>

<body>

<div id="app">

    <!-- TOPO -->
    <div id="tasks"></div>
    <button onclick="addTask()">+</button>

    <hr>

    <!-- BLOCO CENTRAL -->
    <div id="screen" onclick="showPhoneKeyboard()">
        <textarea id="notes" placeholder="Digite os tempos..."></textarea>
    </div>

    <!-- TECLADO -->
    <div id="keyboard" style="display:none;">
        <button onclick="press('1')">1</button>
        <button onclick="press('2')">2</button>
        <button onclick="press('3')">3</button><br>
        <button onclick="press('4')">4</button>
        <button onclick="press('5')">5</button>
        <button onclick="press('6')">6</button><br>
        <button onclick="press('7')">7</button>
        <button onclick="press('8')">8</button>
        <button onclick="press('9')">9</button><br>
        <button onclick="press(':')">*</button>
        <button onclick="press('0')">0</button>
        <button onclick="newline()">â†µ</button>
    </div>

    <hr>

    <!-- RODAPÃ‰ -->
    <div id="footer">
        <span id="totalTime">00:00</span>
        <button onclick="togglePlay()" id="playBtn">â–¶</button>
        <button onclick="clearNotes()">ðŸ—‘</button>
    </div>

</div>

<script>
let tasks = []; // { name: string, color: string }
let timers = [];
let originalTimers = [];
let currentIndex = 0;
let playing = false;
let interval = null;

/* ===== TAREFAS ===== */
function renderTasks(activeTaskIndex = null) {
    let html = "";
    tasks.forEach((t, i) => {
        let size = (i === activeTaskIndex) ? "22px" : "16px";
        let border = (i === activeTaskIndex) ? "2px solid #000" : "none";
        html += `<span style="
            font-size:${size};
            background:${t.color};
            padding:4px 8px;
            border-radius:4px;
            border:${border};
            color:#000;
        ">${t.name}</span> `;
    });
    document.getElementById("tasks").innerHTML = html;
}

function addTask() {
    let name = prompt("Nome da tarefa:");
    if (!name) return;

    let color = prompt("Cor da tarefa: azul, amarelo, vermelho ou roxo").toLowerCase();

    const colorsMap = {
        azul: "#4da3ff",
        amarelo: "#ffd84d",
        vermelho: "#ff5c5c",
        roxo: "#b57bff"
    };

    if (!colorsMap[color]) {
        alert("Cor invÃ¡lida. Use: azul, amarelo, vermelho ou roxo.");
        return;
    }

    tasks.push({ name, color: colorsMap[color] });
    renderTasks();
}

/* ===== TECLADO ===== */
function showPhoneKeyboard() {
    if (!playing) {
        document.getElementById("keyboard").style.display = "block";
    }
}

function hidePhoneKeyboard() {
    document.getElementById("keyboard").style.display = "none";
}

function press(val) {
    document.getElementById("notes").value += val;
    recalc();
}

function newline() {
    document.getElementById("notes").value += "\n";
    recalc();
}

/* ===== LIMPAR ===== */
function clearNotes() {
    stop();
    playing = false;
    document.getElementById("playBtn").innerText = "â–¶";
    document.getElementById("notes").value = "";
    document.getElementById("totalTime").innerText = "00:00";
    document.getElementById("notes").style.background = "#6b6b6b";
    timers = [];
    originalTimers = [];
    currentIndex = 0;
    renderTasks(null);
}

/* ===== TEMPOS ===== */
function parseTimes() {
    let text = document.getElementById("notes").value.trim();
    if (!text) return [];
    let lines = text.split("\n");
    return lines.map(l => {
        let p = l.split(":");
        return parseInt(p[0]) * 60 + parseInt(p[1]);
    });
}

function format(sec) {
    let m = Math.floor(sec / 60);
    let s = sec % 60;
    return String(m).padStart(2,"0") + ":" + String(s).padStart(2,"0");
}

function recalc() {
    let times = parseTimes();
    let total = times.reduce((a,b)=>a+b,0);
    document.getElementById("totalTime").innerText = format(total);
}

/* ===== PLAY / PAUSE ===== */
function togglePlay() {
    if (tasks.length === 0) {
        alert("Adicione pelo menos uma tarefa.");
        return;
    }

    if (parseTimes().length === 0) {
        alert("Adicione pelo menos um tempo.");
        return;
    }

    playing = !playing;
    document.getElementById("playBtn").innerText = playing ? "â¸" : "â–¶";

    if (playing) {
        hidePhoneKeyboard();
        start();
    } else {
        stop();
    }
}

function start() {
    originalTimers = parseTimes();
    timers = [...originalTimers];
    currentIndex = 0;
    run();
}

function run() {
    if (currentIndex >= timers.length) {
        stop();
        return;
    }

    interval = setInterval(() => {
        if (!playing) return;

        timers[currentIndex]--;
        updateDisplay();

        if (timers[currentIndex] <= 0) {
            clearInterval(interval);
            currentIndex++;
            run();
        }
    }, 1000);
}

function stop() {
    clearInterval(interval);
}

/* ===== ATUALIZA UI ===== */
function updateDisplay() {
    let lines = document.getElementById("notes").value.trim().split("\n");
    let newText = "";

    lines.forEach((l, i) => {
        if (i === currentIndex) {
            l = format(timers[i]);
        }
        newText += l + "\n";
    });

    document.getElementById("notes").value = newText.trim();

    let total = timers.reduce((a,b)=>a+b,0);
    document.getElementById("totalTime").innerText = format(total);

    let activeTaskIndex = currentIndex % tasks.length;
    renderTasks(activeTaskIndex);

    // MUDA A COR DO BLOCO DE TEXTO
    if (tasks[activeTaskIndex]) {
        document.getElementById("notes").style.background = tasks[activeTaskIndex].color;
    }
}
</script>

</body>
</html>
